<script src="https://maps.googleapis.com/maps/api/js?
key=AIzaSyBILlW75enYWWwRvtqSSYAp56aVAS-OX_g&callback=initMap"
async defer></script>
<script src="//google-maps-utility-library-v3.googlecode.com/svn/tags/
markerclustererplus/2.0.14/src/markerclusterer_packed.js"></script>


<div class="page-header"> <h1>Clases disponibles</h1></div>
<div class="row">
	<% @activities.each do |activity| %>


	<div class="col-sm-6 col-md-4">
		<div class="thumbnail">
			<%= image_tag(activity.photo, class:"img-responsive") if activity.photo? %>
			<div class="caption">
				<h3><%= activity.name %></h3>
				<p><%= activity.description %></p>
				<p>cupos disponibles :<%= activity.capacity %></p>
				<p><%= link_to 'Ver Horarios', activity, class: 'btn btn-primary' %>
					<%= link_to 'Tomar cupo',activity_takeroom_path(activity) , class: 'btn btn-primary' %></p>
					<% if can? :update, activity %>
					<%= link_to 'Editar', edit_activity_path(activity), class: 'btn btn-primary' %>  
					<% end %>
					<% if can? :destroy, activity %>
					<%= link_to 'Eliminar', activity, method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-danger' %></p>
					<% end %>
				</div>
			</div>
		</div>
		<% end %>
	</div>



	<div class="well">
		<div class="col-sm-4">
			<div class="page-header"> <h1>Datos Sucursal</h1></div>
			<p>
				<strong>Nombre Sucursal:</strong>
				<%= @subsidiary.name %>
			</p>

			<p>
				<strong>Direccion:</strong>
				<%= @subsidiary.address %>
			</p>

			<p>
				<strong>Telefono Contacto:</strong>
				<%= @subsidiary.phone %>
			</p>
		</div>
		<div class="col-sm-8">
			<div style='width: 600px;'>
				<div id="map" style='width: 600px; height: 400px;'></div>
			</div>
		</div>

		<%= link_to 'Edit', edit_subsidiary_path(@subsidiary),class: 'btn btn-primary' %> |
		<%= link_to 'Back', subsidiaries_path,class: 'btn btn-primary	' %>
	</div>
	

		<script>
			document.addEventListener("turbolinks:load",function(){
				$.getScript("//maps.google.com/maps/api/js?key=AIzaSyBILlW75enYWWwRvtqSSYAp56aVAS-OX_g").success(function(){
					$.getScript("//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js").success(function(){
						$.getScript("//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js").success(initMap);
					})
				})
			});
			function initMap(){
				handler = Gmaps.build("Google")
				handler.buildMap({ provider: {
					backgroundColor: "black",
					center: new google.maps.LatLng(-33.4, -70.699),
					zoom: 11},   internal: {id: 'map'}},function(){
						markers = handler.addMarkers(<%=raw @markers.to_json %>);
						handler.bounds.extendWith(markers);
						handler.fitMapToBounds();

					});
			}
		</script>

